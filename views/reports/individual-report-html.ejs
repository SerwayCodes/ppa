<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Student Progress Report - <%- student.first_name %> <%- student.last_name %></title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#003366",
                        "background-light": "#F3F4F6",
                        "background-dark": "#111827",
                        "card-light": "#FFFFFF",
                        "card-dark": "#1F2937",
                        "text-light-primary": "#1F2937",
                        "text-dark-primary": "#F9FAFB",
                        "text-light-secondary": "#6B7280",
                        "text-dark-secondary": "#9CA3AF",
                        "border-light": "#E5E7EB",
                        "border-dark": "#374151",
                    },
                    fontFamily: {
                        display: ["Roboto", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                    },
                },
            },
        };
    </script>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
        @media print {
            body * {
                visibility: hidden;
            }
            main, main * {
                visibility: visible;
            }
            main {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            .print-button {
                display: none !important;
            }
        }
        
        /* Grade colors */
        .grade-A { background-color: #d4edda !important; color: #155724 !important; }
        .grade-B { background-color: #d1ecf1 !important; color: #0c5460 !important; }
        .grade-C { background-color: #fff3cd !important; color: #856404 !important; }
        grade-D { background-color: #f8d7da !important; color: #721c24 !important; }
        .grade-F { background-color: #f5c6cb !important; color: #721c24 !important; }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
    <!-- Print Button -->
    <div class="print-button fixed top-2 right-4 z-50">
        <button onclick="window.print()" class="bg-primary text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-800 transition flex items-center gap-2">
            <i class="material-icons">print</i>
            Print Report
        </button>
    </div>

    <div class="min-h-screen p-2 sm:p-2 lg:p-2 flex items-center justify-center">
        <main class="w-full max-w-4xl bg-card-light dark:bg-card-dark shadow-lg rounded-lg mx-auto">
            <header class="text-center p-1 border-b border-border-light dark:border-border-dark">
                <img alt="Precious Private Academy school logo" class="h-24 mx-auto " src="/assets/img/ppalogo.jpg"/>
                <h1 class="text-lg font-bold uppercase text-primary tracking-wider">Precious Private Academy</h1>
                <p class="text-sm text-text-light-secondary dark:text-text-dark-secondary italic mt-1">"YOUR CHILD'S FUTURE IS NOW NOT LATER"</p>
                <h2 class="text-xl font-bold mt-2 text-text-light-primary dark:text-text-dark-primary">
                    Student Term <%- termNumber %> Progress Report - <%- academicYear %>
                </h2>
            </header>

            <section class="p-6 text-sm">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="flex items-center">
                        <span class="font-semibold text-text-light-secondary dark:text-text-dark-secondary w-28 text-center">Student Reg#:</span>
                        <span class="flex-1  border border-border-light dark:border-border-dark rounded bg-background-light dark:bg-background-dark text-text-light-primary dark:text-text-dark-primary">
                            <%- student.student_id %>
                        </span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-semibold text-text-light-secondary dark:text-text-dark-secondary w-28 text-center">Position:</span>
                        <span class="flex-1  border border-border-light dark:border-border-dark rounded bg-background-light dark:bg-background-dark text-text-light-primary dark:text-text-dark-primary">
                            <%- studentRank.position %>
                        </span>
                        <span class="mx-2 text-text-light-secondary dark:text-text-dark-secondary text-center">Out of</span>
                        <span class="w-16  border border-border-light dark:border-border-dark rounded bg-background-light dark:bg-background-dark text-text-light-primary dark:text-text-dark-primary">
                            <%- studentRank.totalStudents %>
                        </span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-semibold text-text-light-secondary dark:text-text-dark-secondary w-28 text-center">Student Name:</span>
                        <span class="flex-1  border border-border-light dark:border-border-dark rounded bg-background-light dark:bg-background-dark text-text-light-primary dark:text-text-dark-primary">
                            <%- student.first_name %> <%- student.last_name %>
                        </span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-semibold text-text-light-secondary dark:text-text-dark-secondary w-28 text-center">Form:</span>
                        <span class="flex-1  border border-border-light dark:border-border-dark rounded bg-background-light dark:bg-background-dark text-text-light-primary dark:text-text-dark-primary">
                            <%- classInfo.class_name %>
                        </span>
                    </div>
                </div>
            </section>

            <section class="p-6 pt-0">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left border border-border-light dark:border-border-dark">
                        <thead class="bg-gray-700 text-white font-semibold">
                            <tr>
                                <th class="p-3" scope="col">SUBJECT</th>
                                <th class="p-3 text-center" scope="col">MARKS %</th>
                                <th class="p-3 text-center" scope="col">GRADES</th>
                                <th class="p-3 text-center" scope="col">POSITION</th>
                                <th class="p-3" scope="col">REMARKS</th>
                                <th class="p-3" scope="col">SIGN</th>
                            </tr>
                        </thead>
                        <tbody class="text-text-light-primary dark:text-text-dark-primary">
                            <% 
                            // Define all subjects in the order they should appear
                            const subjectOrder = [
                                'AGRICULTURE',
                                'BIBLE KNOWLEDGE',
                                'BIOLOGY',
                                'CHICHEWA',
                                'COMPUTER STUDIES',
                                'ENGLISH',
                                'FRENCH',
                                'GEOGRAPHY',
                                'MATHEMATICS',
                                'CHEMISTRY',
                                'PHYSICS',
                                'SOCIAL AND LIFE'
                            ];
                            
                            let rowClass = '';
                            for (let i = 0; i < subjectOrder.length; i++) {
                                const subjectName = subjectOrder[i];
                                rowClass = i % 2 === 0 ? '' : 'bg-background-light dark:bg-background-dark';
                                const subjectData = subjects.find(s => s.subject_name === subjectName);
                            %>
                            <tr class="border-b border-border-light dark:border-border-dark <%= rowClass %>">
                                <td class=" font-medium"><%= subjectName %></td>
                                <td class="text-center <%= getGradeClass(subjectData ? subjectData.grade : '') %>">
                                    <%= subjectData && subjectData.marks ? subjectData.marks : '' %>
                                </td>
                                <td class="text-center <%= getGradeClass(subjectData ? subjectData.grade : '') %>">
                                    <%= subjectData && subjectData.grade ? subjectData.grade : '' %>
                                </td>
                                <td class=" text-center">
                                    <%= subjectData && subjectData.position ? subjectData.position : '' %>
                                </td>
                                <td class="">
                                    <%= getRemarks(subjectData ? subjectData.grade : '') %>
                                </td>
                                <td class=""></td>
                            </tr>
                            <% } %>
                            
                            
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="px-1 pb-1">
                <div class="bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300 p-1 rounded-lg text-sm flex flex-wrap justify-center items-center gap-x-4 gap-y-2">
                    <span class="font-bold">JCE:</span>
                    <span>A=(80-100)</span>
                    <span>B=(70-79)</span>
                    <span>C=(55-69)</span>
                    <span>D=(40-54)</span>
                    <span>F=(00-39)</span>
                </div>
            </section>

            <section class="p-1 text-sm space-y-2 text-text-light-primary dark:text-text-dark-primary">
                <div>
                    <label class="font-semibold text-text-light-secondary dark:text-text-dark-secondary">Form Teacher Remarks:</label>
                    <div class="mt-1 min-h-2 p-2 border border-border-light dark:border-border-dark rounded bg-background-light dark:bg-background-dark">
                        <%- formTeacherRemarks %>
                    </div>
                </div>
                <div>
                    <label class="font-semibold text-text-light-secondary dark:text-text-dark-secondary">Signature:</label>
                    <div class="mt-1 h-2 border-b border-border-light dark:border-border-dark"></div>
                </div>
                <div>
                    <label class="font-semibold text-text-light-secondary dark:text-text-dark-secondary">Principal's remarks:</label>
                    <div class="mt-1 min-h-2 p-1 border border-border-light dark:border-border-dark rounded bg-background-light dark:bg-background-dark">
                        <%- principalRemarks %>
                    </div>
                </div>
                <div>
                    <label class="font-semibold text-text-light-secondary dark:text-text-dark-secondary">Signature:</label>
                   
                </div>
            </section>

            <footer class="p-2 border-t border-border-light dark:border-border-dark">
                <div class="flex flex-col items-center">
                    <h3 class="text-base font-bold mb-1 text-primary tracking-wide">FEES STRUCTURE FOR NEXT TERM</h3>
                    <table class="w-full max-w-sm text-sm border-collapse border border-border-light dark:border-border-dark">
                        <tbody>
                            <tr class="text-text-light-primary dark:text-text-dark-primary">
                                <td class="p-1 border border-border-light dark:border-border-dark font-medium">DAY SCHOLAR</td>
                                <td class="p-1 border border-border-light dark:border-border-dark text-right">MK150,000.00</td>
                            </tr>
                            <tr class="text-text-light-primary dark:text-text-dark-primary bg-background-light dark:bg-background-dark">
                                <td class="p-1 border border-border-light dark:border-border-dark font-medium">SCHOOL UNIFORM</td>
                                <td class="p-1 border border-border-light dark:border-border-dark text-right">MK110,000.00</td>
                            </tr>
                            <tr class="text-text-light-primary dark:text-text-dark-primary bg-green-100 dark:bg-green-900">
                                <td class="p-1 border border-border-light dark:border-border-dark font-bold">TOTAL</td>
                                <td class="p-1 border border-border-light dark:border-border-dark text-right font-bold">MK260,000.00</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="text-sm mt-2 text-text-light-secondary dark:text-text-dark-secondary">
                        Next term opens on: _________________________
                    </p>
                    
                </div>
            </footer>
        </main>
    </div>

    <script>
        // Helper functions for template
        function getRemarks(grade) {
            if (!grade) return '';
            const remarks = {
                'A': 'Excellent',
                'B': 'Very Good', 
                'C': 'Good',
                'D': 'Satisfactory',
                'F': 'Needs Improvement'
            };
            return remarks[grade] || '';
        }

        function getOverallRemarks(grade) {
            if (!grade) return '';
            const overallRemarks = {
                'A': 'Outstanding Performance',
                'B': 'Very Good Performance',
                'C': 'Good Performance', 
                'D': 'Average Performance',
                'F': 'Needs Significant Improvement'
            };
            return overallRemarks[grade] || '';
        }

        function getGradeClass(grade) {
            if (!grade) return '';
            switch(grade) {
                case 'A': return 'grade-A';
                case 'B': return 'grade-B';
                case 'C': return 'grade-C';
                case 'D': return 'grade-D';
                case 'F': return 'grade-F';
                default: return '';
            }
        }
    </script>
</body>
</html>